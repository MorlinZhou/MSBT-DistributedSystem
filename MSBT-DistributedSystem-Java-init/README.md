# 分布式系统系统描述

该项目将以**最多四名学生为一组进行（小组成员之间应明确划分责任）**。 

该项目的目标是设计和实现一个**远程文件访问系统**。 

本手册描述了系统所需的功能。 

在做项目时你应该查阅讲义和/或教科书。

您需要演示工作程序并在项目结束时提交**实验报告**和经过**良好注释的源代码**。

**提交截止日期为2023年10月23日（星期一）。**

# 功能需求

## 1. 远程文件读取

系统应该允许用户通过指定**文件路径名、偏移量（以字节为单位）**以及要从文件**读取的字节数**来读取文件内容的服务。

该服务返回从文件中指定偏移量（文件中第一个字节的偏移量为 0）开始的给定字节数的文件内容。 

例如，如果从偏移量 1 处的文件内容“abcd”读取 2 个字节，则服务返回“bc”。 

如果服务器上不存在该文件或者偏移量超过文件长度，则应**返回错误消息。**

## 2. 远程文件写入

系统应该允许用户通过**指定文件路径名、偏移量（以字节为单位）**和要**写入文件的字节序列**来将内容插入到文件中。 

该服务将字节序列sequence of bytes插入到文件中指定的偏移量处。 

**偏移点之后的文件原始内容被向后推。** 

例如，如果将“b”插入到文件内容“acd”的偏移量1处，则更新后的文件内容变为“abcd”。 

**成功插入后，服务会向客户端返回确认。** 

如果服务器上不存在该文件或者偏移量超过文件长度，则应**返回错误消息。**

## 3. 远程文件监听

系统应该允许用户在称为**监视间隔(monitor interval)**的指定时间段内监视对服务器上指定文件的内容进行的更新。 

为了注册，客户端向服务器**提供文件路径名和监视间隔（monitor interval）的长度**。

注册后，服务器**记录客户端的互联网地址和端口号。** 

在监控间隔期间，每次任何客户端对文件内容进行更新时，服务器都会**通过回调（callback）将更新的文件内容发送给注册的客户端。**

**监视间隔到期后，客户端记录将从服务器中删除**，服务器将不再向客户端传送文件内容。 

为了简化过程，可以假设发出监视请求的用户在监视间隔到期之前被阻止输入任何新请求，即客户端只需在监视间隔期间等待来自服务器的更新。 因此，**您不必在客户端使用多个线程**。 但是，您的实现应该允许多个客户端同时监视文件的更新。

## 4. 客户端cache

系统应该实现客户端缓存，即客户端读取的文件内容保留在客户端程序的缓冲区中。

为简单起见，可以假设缓存容量足够大（因此不需要实现缓存替换算法）。 

缓存用于加速读取操作。 如果客户端请求的文件内容在缓存中存在，则客户端可以直接读取缓存的内容，而无需联系服务器。 

另一方面，客户端对文件内容所做的更新总是立即发送到服务器。 需要实现近似的单副本更新语义（如课程中所述由 NFS 使用）来维护缓存一致性。

freshness interval *t* 在启动客户端的命令中指定为参数。

## 5. 其他需求

除了上述服务之外，还需要设计并实现另外**两个**通过客户端与服务器通信**对文件进行的操作**。 

其中一个应该是**幂等**的，另一个应该是**非幂等**的。 

在报告中描述您的设计。

除以上需求外，常见的幂等的文件操作有：文件属性查询，文件搜索和查找等；非幂等的文件操作有：创建文件，删除文件，文件重命名等

# 非功能需求

1. 在这个项目中，您需要**自己设计请求/回复消息格式**，**完全实现编组/解组和容错措施**。 您可以使用字节数组来存储编组数据。 不要在 Java 中使用任何现有的 RMI、RPC、CORBA、Java 对象序列化工具和输入/输出流类。
2. 您只需要使用UDP套接字编程中的系统调用编写服务器程序和客户端程序。 为了使客户端能够与服务器进行通信，您可以假设**客户端已知服务器地址和端口号**（例如，可以将服务器地址和端口号指定为启动客户端的命令中的参数）。 计算机的IP地址可以通过命令提示符中的“ipconfig”命令获取。 另一方面，**服务器事先并不知道客户端地址**。 客户端地址是**服务器收到客户端请求时获取的**。 系统中的不同计算机上可以同时运行多个客户端。 为简单起见，您可以假设**客户端发出的请求在时间上是分开的**，以便在处理完请求之前，服务器不会收到来自任何客户端的任何新请求。 因此，您**不必在服务器上创建新线程来处理收到的每个请求**。
3. 客户端提供一个界面（控制台），反复**要求用户输入请求并将请求发送到服务器**。 从服务器返回的**每个回复或错误消息都应打印在屏幕上**。 客户端提供的界面应包括用户终止客户端的选项。 为了简单起见，您可以在**控制台**上设计基于文本的界面，即不需要图形用户界面。
4. 您需要**设计请求和回复消息的结构，并在报告中描述您的设计**。 请注意，不同的操作可能需要不同类型的参数并返回不同类型的结果。 服务器和客户端之间传输的所有消息都必须采用**字节序列**(a sequence of bytes)的形式。 因此，您必须在传输之前对整数值、字符串等进行编组，并在接收时对它们进行解组。 请注意，字符串（例如，文件路径名、要插入文件的内容）需要进行整理，因为它们的长度不固定，并且可能因请求而异。 **您可以考虑在封送消息中添加字符串的长度信息**。
5. 要**实现客户端缓存**，您需要维护缓存内容的一些元信息（例如，**缓存内容的文件路径名、上次验证缓存内容的时间**）。
6. 您需要使用两种不同的调用语义来实现系统：**at-least-once 和 at-most-once**。 为此，您需要实施**timeouts**, **filtering duplicate request messages**, 或 **maintaining histories**等技术。 您可以查阅教科书和讲义，了解调用语义和相关技术的详细信息。 使用哪种语义可以指定为启动客户端/服务器的命令中的参数。 您可以为每个请求分配一个请求标识符，以检测重复的请求。 作为该项目的一部分，您应该在程序中**模拟请求和回复消息的丢失**，并**设计实验来比较**两种调用语义。 **表明至少一次调用语义可能会导致非幂等操作产生错误结果，而最多一次调用语义对于所有操作都可以正确工作。** 描述您的实验并讨论报告中的结果。
7. 该项目的基本要求是用 **C/C++、Java 或任何其他支持进程间通信的语言**编写客户端和服务器程序。 另一个但可选的要求是**使用不同的编程语言实现客户端和服务器** - 例如，一种使用 C/C++，另一种使用 Java。
